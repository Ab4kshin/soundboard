<Window x:Class="soundboard.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:soundboard.ViewModels"
        mc:Ignorable="d"
        Title="Soundboard" Height="600" Width="500"
        Background="#2D2D30"
        AllowDrop="True"
        Drop="Window_Drop">

    <Window.DataContext>
        <vm:MainWindowViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Background" Value="#3E3E42"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Resources>
                <Style TargetType="Border">
                    <Setter Property="CornerRadius" Value="3"/>
                </Style>
            </Style.Resources>
        </Style>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Выбор устройства -->
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="Устройство вывода (Выбери Cable Input для Discord):" Foreground="Gray" FontSize="11"/>
            <ComboBox ItemsSource="{Binding OutputDevices}" 
                      SelectedIndex="{Binding SelectedDeviceIndex}"
                      Padding="5" Margin="0,2,0,0"/>
        </StackPanel>

        <!-- Поиск и добавление -->
        <Grid Grid.Row="1" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- ИСПРАВЛЕНО ЗДЕСЬ: Убрали PlaceholderText, добавили ToolTip -->
            <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                     Grid.Column="0" Padding="5" Margin="0,0,10,0" 
                     ToolTip="Напиши текст для поиска..."/>

            <Button Grid.Column="1" Content="+ Add" Command="{Binding AddSoundCommand}" Background="#007ACC"/>
        </Grid>

        <!-- Список звуков -->
        <Border Grid.Row="2" Background="#1E1E1E" CornerRadius="5">
            <ListView ItemsSource="{Binding Sounds}" Background="Transparent" BorderThickness="0" 
                      HorizontalContentAlignment="Stretch" ScrollViewer.HorizontalScrollBarVisibility="Disabled">

                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="Visibility" Value="{Binding IsVisible, Converter={StaticResource BoolToVis}}"/>
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#333333"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ListView.ItemContainerStyle>

                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Background="#333337" CornerRadius="3" Margin="0,0,10,0" Padding="5,2" MinWidth="30">
                                <TextBlock Text="{Binding HotkeyText}" Foreground="Yellow" FontSize="11" HorizontalAlignment="Center"/>
                            </Border>

                            <TextBlock Grid.Column="1" Text="{Binding Name}" Foreground="White" VerticalAlignment="Center" FontSize="14" TextTrimming="CharacterEllipsis"/>

                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <Button Content="▶" Command="{Binding DataContext.PlaySoundCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                        CommandParameter="{Binding}" Background="Transparent" Foreground="#4CAF50" FontWeight="Bold"/>
                                <Button Content="⚙" Command="{Binding DataContext.EditSoundCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                        CommandParameter="{Binding}" Background="Transparent" Foreground="Gray"/>
                                <Button Content="❌" Command="{Binding DataContext.RemoveSoundCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                        CommandParameter="{Binding}" Background="Transparent" Foreground="#D32F2F"/>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Border>

        <!-- Панель управления -->
        <Grid Grid.Row="3" Margin="0,15,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0" Content="⏹ СТОП" Command="{Binding StopSoundCommand}" Background="#C62828" FontWeight="Bold" Width="80"/>
            <StackPanel Grid.Column="1" Margin="15,0,0,0" VerticalAlignment="Center">
                <Slider Minimum="0" Maximum="1" Value="{Binding Volume}" IsMoveToPointEnabled="True"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>